---
name: Test Suite

on:
  push:
    branches: ["master"]
  pull_request:
    branches: ["master"]

jobs:
  tests_windows:
    name: "Python ${{ matrix.python-version }}"
    runs-on: "windows-latest"

    strategy:
      matrix:
        python-version: ["3.6", "3.7", "3.8"]

    steps:
      - uses: "actions/checkout@v2"
      - uses: "actions/setup-python@v1"
        with:
          python-version: "${{ matrix.python-version }}"
      - name: "Install dependencies"
        run:
          # Prepend newly installed Python to the PATH of this build (this cannot be
          # done from inside the powershell script as it would require to restart
          # the parent CMD process).
          - "SET PATH=%PYTHON%;%PYTHON%\\Scripts;%PATH%"
          - "python --version"
          - "python -m pip install --upgrade pip"
          - "python -m pip install -U click h11 wsproto==0.13.* websockets==8.*"
          - "python -m pip install -U autoflake black codecov flake8 isort pytest pytest-cov requests watchgod"
      - name: "Run tests"
        run:
          - pytest
  tests:
    name: "Python ${{ matrix.python-version }}"
    runs-on: "ubuntu-latest"

    strategy:
      matrix:
        python-version: ["3.6", "3.7", "3.8"]

    steps:
      - uses: "actions/checkout@v2"
      - uses: "actions/setup-python@v1"
        with:
          python-version: "${{ matrix.python-version }}"
      - name: "Install dependencies"
        run: "scripts/install"
      - name: "Run tests"
        run: "scripts/test"
